/*!
 * w-data-collector v1.0.21
 * (c) 2018-2021 yuda-lyu(semisphere)
 * Released under the MIT License.
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("path"),require("fs")):"function"==typeof define&&define.amd?define(["path","fs"],e):(t="undefined"!=typeof globalThis?globalThis:t||self)["w-data-collector"]=e(t.path,t.fs)}(this,(function(t,e){"use strict";function r(t){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(t)}function n(t){var e=function(t,e){if("object"!==r(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var o=n.call(t,e||"default");if("object"!==r(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===r(e)?e:String(e)}function o(t,e,r){return(e=n(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function u(t,e){for(var r=-1,n=null==t?0:t.length;++r<n&&!1!==e(t[r],r,t););return t}var i,a=function(t,e,r){for(var n=-1,o=Object(t),u=r(t),a=u.length;a--;){var c=u[i?a:++n];if(!1===e(o[c],c,o))break}return t};var c="object"==typeof global&&global&&global.Object===Object&&global,f="object"==typeof self&&self&&self.Object===Object&&self,l=c||f||Function("return this")(),s=l.Symbol,p=Object.prototype,v=p.hasOwnProperty,b=p.toString,y=s?s.toStringTag:void 0;var h=Object.prototype.toString;var d="[object Null]",g="[object Undefined]",j=s?s.toStringTag:void 0;function _(t){return null==t?void 0===t?g:d:j&&j in Object(t)?function(t){var e=v.call(t,y),r=t[y];try{t[y]=void 0;var n=!0}catch(t){}var o=b.call(t);return n&&(e?t[y]=r:delete t[y]),o}(t):function(t){return h.call(t)}(t)}function m(t){return null!=t&&"object"==typeof t}function w(t){return m(t)&&"[object Arguments]"==_(t)}var O=Object.prototype,S=O.hasOwnProperty,A=O.propertyIsEnumerable,x=w(function(){return arguments}())?w:function(t){return m(t)&&S.call(t,"callee")&&!A.call(t,"callee")},P=x,T=Array.isArray;var k="object"==typeof exports&&exports&&!exports.nodeType&&exports,z=k&&"object"==typeof module&&module&&!module.nodeType&&module,E=z&&z.exports===k?l.Buffer:void 0,$=(E?E.isBuffer:void 0)||function(){return!1},F=9007199254740991,N=/^(?:0|[1-9]\d*)$/;function B(t,e){var r=typeof t;return!!(e=null==e?F:e)&&("number"==r||"symbol"!=r&&N.test(t))&&t>-1&&t%1==0&&t<e}var M=9007199254740991;function D(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=M}var I={};I["[object Float32Array]"]=I["[object Float64Array]"]=I["[object Int8Array]"]=I["[object Int16Array]"]=I["[object Int32Array]"]=I["[object Uint8Array]"]=I["[object Uint8ClampedArray]"]=I["[object Uint16Array]"]=I["[object Uint32Array]"]=!0,I["[object Arguments]"]=I["[object Array]"]=I["[object ArrayBuffer]"]=I["[object Boolean]"]=I["[object DataView]"]=I["[object Date]"]=I["[object Error]"]=I["[object Function]"]=I["[object Map]"]=I["[object Number]"]=I["[object Object]"]=I["[object RegExp]"]=I["[object Set]"]=I["[object String]"]=I["[object WeakMap]"]=!1;var C,L="object"==typeof exports&&exports&&!exports.nodeType&&exports,R=L&&"object"==typeof module&&module&&!module.nodeType&&module,U=R&&R.exports===L&&c.process,q=function(){try{var t=R&&R.require&&R.require("util").types;return t||U&&U.binding&&U.binding("util")}catch(t){}}(),V=q&&q.isTypedArray,W=V?(C=V,function(t){return C(t)}):function(t){return m(t)&&D(t.length)&&!!I[_(t)]},G=Object.prototype.hasOwnProperty;function H(t,e){var r=T(t),n=!r&&P(t),o=!r&&!n&&$(t),u=!r&&!n&&!o&&W(t),i=r||n||o||u,a=i?function(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n}(t.length,String):[],c=a.length;for(var f in t)!e&&!G.call(t,f)||i&&("length"==f||o&&("offset"==f||"parent"==f)||u&&("buffer"==f||"byteLength"==f||"byteOffset"==f)||B(f,c))||a.push(f);return a}var J=Object.prototype;var K=function(t,e){return function(r){return t(e(r))}}(Object.keys,Object),Q=K,X=Object.prototype.hasOwnProperty;function Y(t){if(r=(e=t)&&e.constructor,e!==("function"==typeof r&&r.prototype||J))return Q(t);var e,r,n=[];for(var o in Object(t))X.call(t,o)&&"constructor"!=o&&n.push(o);return n}function Z(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}var tt="[object AsyncFunction]",et="[object Function]",rt="[object GeneratorFunction]",nt="[object Proxy]";function ot(t){if(!Z(t))return!1;var e=_(t);return e==et||e==rt||e==tt||e==nt}function ut(t){return null!=t&&D(t.length)&&!ot(t)}function it(t){return ut(t)?H(t):Y(t)}var at=function(t,e){return function(r,n){if(null==r)return r;if(!ut(r))return t(r,n);for(var o=r.length,u=e?o:-1,i=Object(r);(e?u--:++u<o)&&!1!==n(i[u],u,i););return r}}((function(t,e){return t&&a(t,e,it)})),ct=at;function ft(t){return t}function lt(t,e){var r;return(T(t)?u:ct)(t,"function"==typeof(r=e)?r:ft)}var st="[object Symbol]";function pt(t){return"symbol"==typeof t||m(t)&&_(t)==st}var vt=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,bt=/^\w*$/;function yt(t,e){if(T(t))return!1;var r=typeof t;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=t&&!pt(t))||(bt.test(t)||!vt.test(t)||null!=e&&t in Object(e))}var ht,dt=l["__core-js_shared__"],gt=(ht=/[^.]+$/.exec(dt&&dt.keys&&dt.keys.IE_PROTO||""))?"Symbol(src)_1."+ht:"";var jt=Function.prototype.toString;function _t(t){if(null!=t){try{return jt.call(t)}catch(t){}try{return t+""}catch(t){}}return""}var mt=/^\[object .+?Constructor\]$/,wt=Function.prototype,Ot=Object.prototype,St=wt.toString,At=Ot.hasOwnProperty,xt=RegExp("^"+St.call(At).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function Pt(t){return!(!Z(t)||function(t){return!!gt&&gt in t}(t))&&(ot(t)?xt:mt).test(_t(t))}function Tt(t,e){var r=function(t,e){return null==t?void 0:t[e]}(t,e);return Pt(r)?r:void 0}var kt=Tt(Object,"create");var zt=Object.prototype.hasOwnProperty;var Et=Object.prototype.hasOwnProperty;function $t(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function Ft(t,e){return t===e||t!=t&&e!=e}function Nt(t,e){for(var r=t.length;r--;)if(Ft(t[r][0],e))return r;return-1}$t.prototype.clear=function(){this.__data__=kt?kt(null):{},this.size=0},$t.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},$t.prototype.get=function(t){var e=this.__data__;if(kt){var r=e[t];return"__lodash_hash_undefined__"===r?void 0:r}return zt.call(e,t)?e[t]:void 0},$t.prototype.has=function(t){var e=this.__data__;return kt?void 0!==e[t]:Et.call(e,t)},$t.prototype.set=function(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=kt&&void 0===e?"__lodash_hash_undefined__":e,this};var Bt=Array.prototype.splice;function Mt(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}Mt.prototype.clear=function(){this.__data__=[],this.size=0},Mt.prototype.delete=function(t){var e=this.__data__,r=Nt(e,t);return!(r<0)&&(r==e.length-1?e.pop():Bt.call(e,r,1),--this.size,!0)},Mt.prototype.get=function(t){var e=this.__data__,r=Nt(e,t);return r<0?void 0:e[r][1]},Mt.prototype.has=function(t){return Nt(this.__data__,t)>-1},Mt.prototype.set=function(t,e){var r=this.__data__,n=Nt(r,t);return n<0?(++this.size,r.push([t,e])):r[n][1]=e,this};var Dt=Tt(l,"Map");function It(t,e){var r,n,o=t.__data__;return("string"==(n=typeof(r=e))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==r:null===r)?o["string"==typeof e?"string":"hash"]:o.map}function Ct(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}Ct.prototype.clear=function(){this.size=0,this.__data__={hash:new $t,map:new(Dt||Mt),string:new $t}},Ct.prototype.delete=function(t){var e=It(this,t).delete(t);return this.size-=e?1:0,e},Ct.prototype.get=function(t){return It(this,t).get(t)},Ct.prototype.has=function(t){return It(this,t).has(t)},Ct.prototype.set=function(t,e){var r=It(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this};var Lt="Expected a function";function Rt(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new TypeError(Lt);var r=function(){var n=arguments,o=e?e.apply(this,n):n[0],u=r.cache;if(u.has(o))return u.get(o);var i=t.apply(this,n);return r.cache=u.set(o,i)||u,i};return r.cache=new(Rt.Cache||Ct),r}Rt.Cache=Ct;var Ut=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,qt=/\\(\\)?/g,Vt=function(t){var e=Rt(t,(function(t){return 500===r.size&&r.clear(),t})),r=e.cache;return e}((function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(Ut,(function(t,r,n,o){e.push(n?o.replace(qt,"$1"):r||t)})),e})),Wt=Vt;function Gt(t,e){for(var r=-1,n=null==t?0:t.length,o=Array(n);++r<n;)o[r]=e(t[r],r,t);return o}var Ht=1/0,Jt=s?s.prototype:void 0,Kt=Jt?Jt.toString:void 0;function Qt(t){if("string"==typeof t)return t;if(T(t))return Gt(t,Qt)+"";if(pt(t))return Kt?Kt.call(t):"";var e=t+"";return"0"==e&&1/t==-Ht?"-0":e}function Xt(t,e){return T(t)?t:yt(t,e)?[t]:Wt(function(t){return null==t?"":Qt(t)}(t))}var Yt=1/0;function Zt(t){if("string"==typeof t||pt(t))return t;var e=t+"";return"0"==e&&1/t==-Yt?"-0":e}function te(t,e){for(var r=0,n=(e=Xt(e,t)).length;null!=t&&r<n;)t=t[Zt(e[r++])];return r&&r==n?t:void 0}function ee(t,e,r){var n=null==t?void 0:te(t,e);return void 0===n?r:n}var re=Tt(l,"DataView"),ne=Tt(l,"Promise"),oe=Tt(l,"Set"),ue=Tt(l,"WeakMap"),ie="[object Map]",ae="[object Promise]",ce="[object Set]",fe="[object WeakMap]",le="[object DataView]",se=_t(re),pe=_t(Dt),ve=_t(ne),be=_t(oe),ye=_t(ue),he=_;(re&&he(new re(new ArrayBuffer(1)))!=le||Dt&&he(new Dt)!=ie||ne&&he(ne.resolve())!=ae||oe&&he(new oe)!=ce||ue&&he(new ue)!=fe)&&(he=function(t){var e=_(t),r="[object Object]"==e?t.constructor:void 0,n=r?_t(r):"";if(n)switch(n){case se:return le;case pe:return ie;case ve:return ae;case be:return ce;case ye:return fe}return e});var de=he,ge="[object String]";function je(t){return function(e){return null==e?void 0:e[t]}}var _e=je("length"),me=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]");var we="\\ud800-\\udfff",Oe="["+we+"]",Se="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",Ae="\\ud83c[\\udffb-\\udfff]",xe="[^"+we+"]",Pe="(?:\\ud83c[\\udde6-\\uddff]){2}",Te="[\\ud800-\\udbff][\\udc00-\\udfff]",ke="(?:"+Se+"|"+Ae+")"+"?",ze="[\\ufe0e\\ufe0f]?",Ee=ze+ke+("(?:\\u200d(?:"+[xe,Pe,Te].join("|")+")"+ze+ke+")*"),$e="(?:"+[xe+Se+"?",Se,Pe,Te,Oe].join("|")+")",Fe=RegExp(Ae+"(?="+Ae+")|"+$e+Ee,"g");function Ne(t){return function(t){return me.test(t)}(t)?function(t){for(var e=Fe.lastIndex=0;Fe.test(t);)++e;return e}(t):_e(t)}var Be="[object Map]",Me="[object Set]";function De(t){if(null==t)return 0;if(ut(t))return"string"==typeof(e=t)||!T(e)&&m(e)&&_(e)==ge?Ne(t):t.length;var e,r=de(t);return r==Be||r==Me?t.size:Y(t).length}function Ie(t){return"[object Object]"===Object.prototype.toString.call(t)}function Ce(t){return"[object String]"===Object.prototype.toString.call(t)}function Le(t){return!(!Ce(t)||""===t)}function Re(t){let e=!1;if(Le(t))e=!isNaN(Number(t));else if(function(t){return"[object Number]"===Object.prototype.toString.call(t)}(t)){if(function(t){return t!=t}(t))return!1;e=!0}return e}function Ue(t){if(Ie(t)){for(let e in t)return!0;return!1}return!1}function qe(t){let e=Object.prototype.toString.call(t);return"[object Function]"===e||"[object AsyncFunction]"===e}var Ve="[object Boolean]";function We(t){return!0===(e=t)||!1===e||m(e)&&_(e)==Ve;var e}function Ge(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function He(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Ge(Object(r),!0).forEach((function(e){o(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Ge(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function Je(t){var e=this.__data__=new Mt(t);this.size=e.size}Je.prototype.clear=function(){this.__data__=new Mt,this.size=0},Je.prototype.delete=function(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r},Je.prototype.get=function(t){return this.__data__.get(t)},Je.prototype.has=function(t){return this.__data__.has(t)},Je.prototype.set=function(t,e){var r=this.__data__;if(r instanceof Mt){var n=r.__data__;if(!Dt||n.length<199)return n.push([t,e]),this.size=++r.size,this;r=this.__data__=new Ct(n)}return r.set(t,e),this.size=r.size,this};function Ke(t){var e=-1,r=null==t?0:t.length;for(this.__data__=new Ct;++e<r;)this.add(t[e])}function Qe(t,e){for(var r=-1,n=null==t?0:t.length;++r<n;)if(e(t[r],r,t))return!0;return!1}Ke.prototype.add=Ke.prototype.push=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this},Ke.prototype.has=function(t){return this.__data__.has(t)};var Xe=1,Ye=2;function Ze(t,e,r,n,o,u){var i=r&Xe,a=t.length,c=e.length;if(a!=c&&!(i&&c>a))return!1;var f=u.get(t),l=u.get(e);if(f&&l)return f==e&&l==t;var s=-1,p=!0,v=r&Ye?new Ke:void 0;for(u.set(t,e),u.set(e,t);++s<a;){var b=t[s],y=e[s];if(n)var h=i?n(y,b,s,e,t,u):n(b,y,s,t,e,u);if(void 0!==h){if(h)continue;p=!1;break}if(v){if(!Qe(e,(function(t,e){if(i=e,!v.has(i)&&(b===t||o(b,t,r,n,u)))return v.push(e);var i}))){p=!1;break}}else if(b!==y&&!o(b,y,r,n,u)){p=!1;break}}return u.delete(t),u.delete(e),p}var tr=l.Uint8Array;function er(t){var e=-1,r=Array(t.size);return t.forEach((function(t,n){r[++e]=[n,t]})),r}function rr(t){var e=-1,r=Array(t.size);return t.forEach((function(t){r[++e]=t})),r}var nr=1,or=2,ur="[object Boolean]",ir="[object Date]",ar="[object Error]",cr="[object Map]",fr="[object Number]",lr="[object RegExp]",sr="[object Set]",pr="[object String]",vr="[object Symbol]",br="[object ArrayBuffer]",yr="[object DataView]",hr=s?s.prototype:void 0,dr=hr?hr.valueOf:void 0;var gr=Object.prototype.propertyIsEnumerable,jr=Object.getOwnPropertySymbols,_r=jr?function(t){return null==t?[]:(t=Object(t),function(t,e){for(var r=-1,n=null==t?0:t.length,o=0,u=[];++r<n;){var i=t[r];e(i,r,t)&&(u[o++]=i)}return u}(jr(t),(function(e){return gr.call(t,e)})))}:function(){return[]};function mr(t){return function(t,e,r){var n=e(t);return T(t)?n:function(t,e){for(var r=-1,n=e.length,o=t.length;++r<n;)t[o+r]=e[r];return t}(n,r(t))}(t,it,_r)}var wr=1,Or=Object.prototype.hasOwnProperty;var Sr=1,Ar="[object Arguments]",xr="[object Array]",Pr="[object Object]",Tr=Object.prototype.hasOwnProperty;function kr(t,e,r,n,o,u){var i=T(t),a=T(e),c=i?xr:de(t),f=a?xr:de(e),l=(c=c==Ar?Pr:c)==Pr,s=(f=f==Ar?Pr:f)==Pr,p=c==f;if(p&&$(t)){if(!$(e))return!1;i=!0,l=!1}if(p&&!l)return u||(u=new Je),i||W(t)?Ze(t,e,r,n,o,u):function(t,e,r,n,o,u,i){switch(r){case yr:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case br:return!(t.byteLength!=e.byteLength||!u(new tr(t),new tr(e)));case ur:case ir:case fr:return Ft(+t,+e);case ar:return t.name==e.name&&t.message==e.message;case lr:case pr:return t==e+"";case cr:var a=er;case sr:var c=n&nr;if(a||(a=rr),t.size!=e.size&&!c)return!1;var f=i.get(t);if(f)return f==e;n|=or,i.set(t,e);var l=Ze(a(t),a(e),n,o,u,i);return i.delete(t),l;case vr:if(dr)return dr.call(t)==dr.call(e)}return!1}(t,e,c,r,n,o,u);if(!(r&Sr)){var v=l&&Tr.call(t,"__wrapped__"),b=s&&Tr.call(e,"__wrapped__");if(v||b){var y=v?t.value():t,h=b?e.value():e;return u||(u=new Je),o(y,h,r,n,u)}}return!!p&&(u||(u=new Je),function(t,e,r,n,o,u){var i=r&wr,a=mr(t),c=a.length;if(c!=mr(e).length&&!i)return!1;for(var f=c;f--;){var l=a[f];if(!(i?l in e:Or.call(e,l)))return!1}var s=u.get(t),p=u.get(e);if(s&&p)return s==e&&p==t;var v=!0;u.set(t,e),u.set(e,t);for(var b=i;++f<c;){var y=t[l=a[f]],h=e[l];if(n)var d=i?n(h,y,l,e,t,u):n(y,h,l,t,e,u);if(!(void 0===d?y===h||o(y,h,r,n,u):d)){v=!1;break}b||(b="constructor"==l)}if(v&&!b){var g=t.constructor,j=e.constructor;g==j||!("constructor"in t)||!("constructor"in e)||"function"==typeof g&&g instanceof g&&"function"==typeof j&&j instanceof j||(v=!1)}return u.delete(t),u.delete(e),v}(t,e,r,n,o,u))}function zr(t,e,r,n,o){return t===e||(null==t||null==e||!m(t)&&!m(e)?t!=t&&e!=e:kr(t,e,r,n,zr,o))}var Er=1,$r=2;function Fr(t){return t==t&&!Z(t)}function Nr(t,e){return function(r){return null!=r&&(r[t]===e&&(void 0!==e||t in Object(r)))}}function Br(t){var e=function(t){for(var e=it(t),r=e.length;r--;){var n=e[r],o=t[n];e[r]=[n,o,Fr(o)]}return e}(t);return 1==e.length&&e[0][2]?Nr(e[0][0],e[0][1]):function(r){return r===t||function(t,e,r,n){var o=r.length,u=o,i=!n;if(null==t)return!u;for(t=Object(t);o--;){var a=r[o];if(i&&a[2]?a[1]!==t[a[0]]:!(a[0]in t))return!1}for(;++o<u;){var c=(a=r[o])[0],f=t[c],l=a[1];if(i&&a[2]){if(void 0===f&&!(c in t))return!1}else{var s=new Je;if(n)var p=n(f,l,c,t,e,s);if(!(void 0===p?zr(l,f,Er|$r,n,s):p))return!1}}return!0}(r,t,e)}}function Mr(t,e){return null!=t&&e in Object(t)}function Dr(t,e){return null!=t&&function(t,e,r){for(var n=-1,o=(e=Xt(e,t)).length,u=!1;++n<o;){var i=Zt(e[n]);if(!(u=null!=t&&r(t,i)))break;t=t[i]}return u||++n!=o?u:!!(o=null==t?0:t.length)&&D(o)&&B(i,o)&&(T(t)||P(t))}(t,e,Mr)}var Ir=1,Cr=2;function Lr(t){return yt(t)?je(Zt(t)):function(t){return function(e){return te(e,t)}}(t)}function Rr(t){return"function"==typeof t?t:null==t?ft:"object"==typeof t?T(t)?function(t,e){return yt(t)&&Fr(e)?Nr(Zt(t),e):function(r){var n=ee(r,t);return void 0===n&&n===e?Dr(r,t):zr(e,n,Ir|Cr)}}(t[0],t[1]):Br(t):Lr(t)}function Ur(t,e){var r=-1,n=ut(t)?Array(t.length):[];return ct(t,(function(t,o,u){n[++r]=e(t,o,u)})),n}function qr(t,e){return(T(t)?Gt:Ur)(t,Rr(e))}var Vr=Array.prototype.join;function Wr(t,e){return null==t?"":Vr.call(t,e)}function Gr(t){return!!e.existsSync(t)&&(!e.lstatSync(t).isFile()&&!e.lstatSync(t).isSymbolicLink())}function Hr(t,e,r){if(!Le(t))return"";if(!Le(e))return"";if(!Ce(r))return"";return String(t).replaceAll(e,r)}var Jr=/\s/;var Kr=/^\s+/;function Qr(t){return t?t.slice(0,function(t){for(var e=t.length;e--&&Jr.test(t.charAt(e)););return e}(t)+1).replace(Kr,""):t}var Xr=NaN,Yr=/^[-+]0x[0-9a-f]+$/i,Zr=/^0b[01]+$/i,tn=/^0o[0-7]+$/i,en=parseInt;var rn=1/0,nn=17976931348623157e292;function on(t){return t?(t=function(t){if("number"==typeof t)return t;if(pt(t))return Xr;if(Z(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=Z(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=Qr(t);var r=Zr.test(t);return r||tn.test(t)?en(t.slice(2),r?2:8):Yr.test(t)?Xr:+t}(t))===rn||t===-rn?(t<0?-1:1)*nn:t==t?t:0:0===t?t:0}function un(t,e,r){var n,o,u=null==t?0:t.length;return u?function(t,e,r){var n=-1,o=t.length;e<0&&(e=-e>o?0:o+e),(r=r>o?o:r)<0&&(r+=o),o=e>r?0:r-e>>>0,e>>>=0;for(var u=Array(o);++n<o;)u[n]=t[n+e];return u}(t,(e=r||void 0===e?1:(n=on(e),o=n%1,n==n?o?n-o:n:0))<0?0:e,u):[]}function an(t,e){let r=function(){let t,e,r=new Promise((function(){t=arguments[0],e=arguments[1]}));return r.resolve=t,r.reject=e,r}();if(n=t,"[object Array]"!==Object.prototype.toString.call(n)&&!Ie(t))return r.reject("rs is not an array or object"),r;var n;let o=!1;if(Ie(t)){o=!0;let e=[];lt(t,((t,r)=>{e.push({k:r,v:t})})),t=e}qe(e)||(e=function(t){return t});let u=-1,i=[];return t.reduce((function(t,r){return t.then((function(t){i.push(t),u+=1;let n=u,a=r;return o&&(n=r.k,a=r.v),qe(e)?e(a,n):a}))}),Promise.resolve()).then((function(t){i.push(t),i=un(i),r.resolve(i)})).catch((function(t){r.reject(t)})),r}let cn={build:function(t){let e=ee(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},"useCreateStorage");We(e)||(e=!1);let{keyTable:r,tableNameCht:n,tableNameEng:o,settings:u,parser:i,funNew:a,funTest:c,ext:f}=t;if(!Le(r))throw new Error(`invalid keyTable[${r}]`);if(Le(n)||(n=r),Le(o)||(o=r),!Ue(u))throw new Error("invalid settings");Ue(f)||(f=null),Ue(i)||(i=null),qe(a)||(a=null);let l=null;qe(c)&&(l=async t=>{if(!Ue(t))throw new Error("invalid wo");if(o=r,!Ie(n=t)||!Le(o)&&!Re(o)||!(o in n))throw console.log(t),new Error(`keyTable[${r}] is not in wo`);var n,o;let u=[];try{u=c(),function(t){let e,r=Object.prototype.toString.call(t);if(e="[object Promise]"===r,e)return!0;if("[object Function]"!==r)return!1;try{e="function"!=typeof t.subscribe&&"function"==typeof t.then}catch(t){}return e}(u)&&(u=await u)}catch(t){throw console.log(`keyTable[${r}] funTest catch`,t),new Error(t)}if(0!==De(u))return e&&await t[r].createStorage(),await t[r].save(u),u});let s={},p={};return lt(it(u),(t=>{let e=ee(u,`${t}.name`,"");Le(e)&&(s[t]=e);let r=ee(u,`${t}.type`,"");Le(r)&&(p[t]=r)})),He(He({},t),{},{keyTable:r,tableNameCht:n,tableNameEng:o,settings:u,keys:it(u),kpType:p,kpHead:s,parser:i,funNew:a,funTest:c,funTestAndSave:l,ext:f})},genIndex:function(r,n){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},u=ee(o,"fpBuild");Le(u)||(u="w-data-collector/src/build.mjs");let i=ee(o,"fnIndex");Le(i)||(i="index.mjs");let a=ee(o,"useCreateStorage");We(a)||(a=!1);let c=function(r){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,o=1;if(!Gr(r))throw new Error(`fd[${r}] is not a folder`);return function r(u){let i=[];return Gr(u)?(lt(e.readdirSync(u),(function(a){let c=t.resolve(u,a),f=null;try{f=e.statSync(c)}catch(t){}f&&f.isDirectory()?(i.push({isFolder:!0,level:o,path:c,name:t.basename(c)}),o+=1,(o<=n||null===n)&&(i=i.concat(r(c))),o-=1):i.push({isFolder:!1,level:o,path:c,name:t.basename(c)})})),i):i}(r)}(r),f=qr(c,(e=>{let r=e.name;r=Hr(r,".mjs",""),r=Hr(r,".js","");let o=t.relative(n,e.path);return o=o.replace(/\\/g,"/"),o=`./${o}`,{name:r,src:o}})),l=`{cimps}\nimport build from '{fpBuild}'\n\n\nlet cs = {\n{cnms}\n}\n\n//ds\nlet ds = {}\nfor (let k in cs) {\n    ds[k] = build(cs[k], { useCreateStorage: ${a} })\n}\n\n\nexport default ds\n`,s=function(t){return Wr(qr(t,(t=>{let e="import {name} from '{src}'";return e=Hr(e,"{name}",t.name),e=Hr(e,"{src}",t.src),e})),"\n")}(f),p=function(t){return Wr(qr(t,(t=>{let e="    {name},";return e=Hr(e,"{name}",t.name),e})),"\n")}(f);l=Hr(l,"{cimps}",s),l=Hr(l,"{cnms}",p),l=Hr(l,"{fpBuild}",u);let v=t.resolve(n,i);e.writeFileSync(v,l,"utf8"),console.log("genIndex done")},genTestdata:async function(e,r){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=ee(n,"useGenModels");We(o)||(o=!1),o&&(!function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=ee(r,"fdModels");Le(n)||(n=`${t.resolve()}/models`);let o=ee(r,"genModelsByTabs");if(!qe(o))throw new Error("opt.genModelsByTabs is not a function, it needs to import from 'w-orm-reladb/src/genModelsByTabs.mjs'");let u={};lt(e,((t,e)=>{u[e]=t.settings})),o(n,u)}(e,n),console.log("genModels done"));let u=it(e);await an(u,(async t=>{qe(ee(e,`${t}.funTestAndSave`))&&await e[t].funTestAndSave(r)})),console.log("genTestdata done",u)}};return cn}));
//# sourceMappingURL=w-data-collector.umd.js.map
